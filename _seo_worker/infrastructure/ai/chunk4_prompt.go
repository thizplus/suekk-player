package ai

import (
	"fmt"
	"strings"

	"github.com/google/generative-ai-go/genai"
	"seo-worker/domain/models"
	"seo-worker/domain/ports"
)

// ============================================================================
// Chunk 4: Deep Analysis (‡πÄ‡∏û‡∏¥‡πà‡∏° Text ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SEO - Text/HTML Ratio)
// Focus: Cinematography, Character Journey, Educational, Comparison, Viewing Tips
// ‚ö†Ô∏è CRITICAL: ‡πÉ‡∏ä‡πâ context ‡∏à‡∏≤‡∏Å Chunk 1 + Chunk 2 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
// ============================================================================

// buildChunk4Schema ‡∏™‡∏£‡πâ‡∏≤‡∏á JSON Schema ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Chunk 4
func (c *GeminiClient) buildChunk4Schema() *genai.Schema {
	return &genai.Schema{
		Type: genai.TypeObject,
		Properties: map[string]*genai.Schema{
			// === 1. Cinematography & Atmosphere ===
			"cinematographyAnalysis": {
				Type:        genai.TypeString,
				Description: "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®: ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏á ‡∏°‡∏∏‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á ‡∏™‡∏µ‡πÇ‡∏ó‡∏ô ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ close-up (300-500 ‡∏Ñ‡∏≥ / 4-5 ‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤)",
			},
			"visualStyle": {
				Type:        genai.TypeString,
				Description: "‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏†‡∏≤‡∏û‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏° ‡πÄ‡∏ä‡πà‡∏ô '‡πÅ‡∏™‡∏á‡∏ô‡∏ß‡∏•‡∏ï‡∏≤‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å ‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏ï‡πà‡πÅ‡∏ù‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πâ‡∏≤‡∏£‡πâ‡∏≠‡∏ô' (50-80 ‡∏Ñ‡∏≥)",
			},
			"atmosphereNotes": {
				Type:        genai.TypeArray,
				Items:       &genai.Schema{Type: genai.TypeString},
				Description: "3-5 ‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏® ‡πÄ‡∏ä‡πà‡∏ô ['‡πÅ‡∏™‡∏á‡∏Ç‡∏≤‡∏ß‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å', '‡∏°‡∏∏‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á POV ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î']",
			},

			// === 2. Character Emotional Journey ===
			"characterJourney": {
				Type:        genai.TypeString,
				Description: "‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏´‡∏•‡∏±‡∏Å: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏≠‡∏∞‡πÑ‡∏£ ‚Üí ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÑ‡∏õ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£ ‚Üí ‡∏à‡∏ö‡∏•‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£ (400-600 ‡∏Ñ‡∏≥ / 5-6 ‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤)",
			},
			"emotionalArc": {
				Type: genai.TypeArray,
				Items: &genai.Schema{
					Type: genai.TypeObject,
					Properties: map[string]*genai.Schema{
						"phase":       {Type: genai.TypeString, Description: "‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', '‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á', '‡πÑ‡∏Ñ‡∏•‡πÅ‡∏°‡∏Å‡∏ã‡πå'"},
						"emotion":     {Type: genai.TypeString, Description: "‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏´‡∏•‡∏±‡∏Å ‡πÄ‡∏ä‡πà‡∏ô '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•', '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡πâ‡∏ß‡∏≤‡∏á‡πÉ‡∏à'"},
						"description": {Type: genai.TypeString, Description: "‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢ 30-50 ‡∏Ñ‡∏≥"},
					},
					Required: []string{"phase", "emotion", "description"},
				},
				Description: "3-4 ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á emotional arc",
			},

			// === 3. Educational Context (Thematic Analysis) ===
			"thematicExplanation": {
				Type:        genai.TypeString,
				Description: "‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ò‡∏µ‡∏°/‡πÅ‡∏ô‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ô‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£ (300-500 ‡∏Ñ‡∏≥) ‡πÄ‡∏ä‡πà‡∏ô ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Medical Drama ‚Üí ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤, ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Office ‚Üí ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ power dynamics",
			},
			"culturalContext": {
				Type:        genai.TypeString,
				Description: "‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏ó‡∏≤‡∏á‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á (100-150 ‡∏Ñ‡∏≥) ‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏´‡∏°‡∏≠-‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡πÉ‡∏ô‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô",
			},
			"genreInsights": {
				Type:        genai.TypeArray,
				Items:       &genai.Schema{Type: genai.TypeString},
				Description: "3-5 ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÅ‡∏ô‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á",
			},

			// === 4. Comparative Analysis ===
			"studioComparison": {
				Type:        genai.TypeString,
				Description: "‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏Ñ‡πà‡∏≤‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô: ‡∏à‡∏∏‡∏î‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô ‡∏à‡∏∏‡∏î‡∏ï‡πà‡∏≤‡∏á ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô (200-300 ‡∏Ñ‡∏≥)",
			},
			"actorEvolution": {
				Type:        genai.TypeString,
				Description: "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (200-300 ‡∏Ñ‡∏≥)",
			},
			"genreRanking": {
				Type:        genai.TypeString,
				Description: "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡πÄ‡∏ä‡πà‡∏ô '‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Medical ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏õ‡∏µ' (50-100 ‡∏Ñ‡∏≥)",
			},

			// === 5. Viewing Experience & Recommendation ===
			"viewingTips": {
				Type:        genai.TypeString,
				Description: "‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ä‡∏°: ‡∏Ñ‡∏ß‡∏£‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏à‡∏∏‡∏î‡πÑ‡∏´‡∏ô ‡∏ä‡πà‡∏ß‡∏á‡πÑ‡∏´‡∏ô‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à (200-300 ‡∏Ñ‡∏≥)",
			},
			"bestMoments": {
				Type:        genai.TypeArray,
				Items:       &genai.Schema{Type: genai.TypeString},
				Description: "3-5 ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡πÄ‡∏ä‡∏¥‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ timestamp) ‡πÄ‡∏ä‡πà‡∏ô '‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å'",
			},
			"audienceMatch": {
				Type:        genai.TypeString,
				Description: "‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£ (100-150 ‡∏Ñ‡∏≥)",
			},
			"replayValue": {
				Type:        genai.TypeString,
				Description: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏ã‡πâ‡∏≥ ‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏î‡∏π (50-100 ‡∏Ñ‡∏≥)",
			},
		},
		Required: []string{
			// Section 1
			"cinematographyAnalysis", "visualStyle", "atmosphereNotes",
			// Section 2
			"characterJourney", "emotionalArc",
			// Section 3
			"thematicExplanation", "culturalContext", "genreInsights",
			// Section 4
			"studioComparison", "actorEvolution", "genreRanking",
			// Section 5
			"viewingTips", "bestMoments", "audienceMatch", "replayValue",
		},
	}
}

// buildChunk4Prompt ‡∏™‡∏£‡πâ‡∏≤‡∏á prompt ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Chunk 4
// ‚ö†Ô∏è CRITICAL: ‡∏£‡∏±‡∏ö context ‡∏à‡∏≤‡∏Å Chunk 1 + Chunk 2 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
func (c *GeminiClient) buildChunk4Prompt(input *ports.AIInput, chunk1 *Chunk1Output, chunk2 *Chunk2Output) string {
	// ‡∏™‡∏£‡πâ‡∏≤‡∏á cast names string
	castNames := make([]string, len(input.Casts))
	for i, cast := range input.Casts {
		castNames[i] = cast.Name
	}

	// ‡∏™‡∏£‡πâ‡∏≤‡∏á tags string
	var tagsStr strings.Builder
	for _, tag := range input.Tags {
		tagsStr.WriteString(fmt.Sprintf("- %s\n", tag.Name))
	}

	// ‡∏™‡∏£‡πâ‡∏≤‡∏á highlights string
	highlightsStr := ""
	for i, h := range chunk1.Highlights {
		highlightsStr += fmt.Sprintf("%d. %s\n", i+1, h)
	}

	// ‡∏™‡∏£‡πâ‡∏≤‡∏á mood tone string
	moodToneStr := strings.Join(chunk2.MoodTone, ", ")

	// Format duration
	durationStr := formatDurationThai(input.VideoMetadata.Duration)

	return fmt.Sprintf(`# ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (Persona)
‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ "‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡πå‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°" ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç:
- ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Cinematography ‡πÅ‡∏•‡∏∞ Visual Aesthetics
- ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (Character Arc)
- ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
- ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ä‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≤

---

## ‚ö†Ô∏è Context ‡∏à‡∏≤‡∏Å Chunk 1 + Chunk 2 (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!)

### Summary (‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å - ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà):
%s

### Highlights (‡∏â‡∏≤‡∏Å‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç - ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå):
%s

### Setting & Atmosphere:
- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: %s
- ‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®/‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå: %s
- ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏â‡∏≤‡∏Å: %s

### Character Analysis (‡∏à‡∏≤‡∏Å Chunk 2):
- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£: %s
- ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å: %s
- ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: %s

### Comparison Context (‡∏à‡∏≤‡∏Å Chunk 2):
%s

---

## ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Video

- Code: %s
- Duration: %s
- Casts: %s
- Studio/Maker: %s
- Tags:
%s

---

## Output Requirements (Chunk 4: Deep Analysis - ‡πÄ‡∏û‡∏¥‡πà‡∏° Text ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SEO)

### üé¨ Section 1: Cinematography & Atmosphere (‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏û)
1. **cinematographyAnalysis**: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏û **300-500 ‡∏Ñ‡∏≥** (4-5 ‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤)
   - ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏á (Lighting): ‡πÅ‡∏™‡∏á‡∏ô‡∏ß‡∏•‡∏ï‡∏≤, ‡πÅ‡∏™‡∏á‡∏à‡πâ‡∏≤, ‡πÅ‡∏™‡∏á‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥
   - ‡∏°‡∏∏‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á (Camera Angles): Close-up, Wide shot, POV
   - ‡∏™‡∏µ‡πÇ‡∏ó‡∏ô (Color Grading): ‡πÇ‡∏ó‡∏ô‡∏≠‡∏∏‡πà‡∏ô, ‡πÄ‡∏¢‡πá‡∏ô, Clinical white
   - ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (Composition)
   - ‚ö†Ô∏è ‡πÉ‡∏ä‡πâ‡∏®‡∏±‡∏û‡∏ó‡πå‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå (Google ‡∏ä‡∏≠‡∏ö!)

2. **visualStyle**: ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏†‡∏≤‡∏û‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏° 50-80 ‡∏Ñ‡∏≥
3. **atmosphereNotes**: 3-5 ‡∏à‡∏∏‡∏î‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®

### üé≠ Section 2: Character Emotional Journey (‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£)
4. **characterJourney**: ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå **400-600 ‡∏Ñ‡∏≥** (5-6 ‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤)
   - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£ (Anxiety, Curiosity, Fear)
   - ‡∏û‡∏±‡∏í‡∏ô‡∏≤: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£
   - ‡πÑ‡∏Ñ‡∏•‡πÅ‡∏°‡∏Å‡∏ã‡πå: ‡∏à‡∏∏‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏≤‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå
   - ‡∏à‡∏ö: ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏õ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£
   - ‚ö†Ô∏è ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏î‡πâ‡∏≤‡∏ô Psychology/Emotions

5. **emotionalArc**: 3-4 ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á arc
   - phase: ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
   - emotion: ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏´‡∏•‡∏±‡∏Å
   - description: ‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢ 30-50 ‡∏Ñ‡∏≥

### üìö Section 3: Educational Context (‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å)
6. **thematicExplanation**: ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ò‡∏µ‡∏° **300-500 ‡∏Ñ‡∏≥**
   - ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Medical: ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏´‡∏°‡∏≠-‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ
   - ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Office: ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ power dynamics, ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô
   - ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô School: ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Ñ‡∏£‡∏π-‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
   - ‚ö†Ô∏è ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö Educational/Informative - ‡∏î‡∏∂‡∏á Traffic ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

7. **culturalContext**: ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô 100-150 ‡∏Ñ‡∏≥
8. **genreInsights**: 3-5 ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÅ‡∏ô‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á

### ‚öñÔ∏è Section 4: Comparative Analysis (‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö)
9. **studioComparison**: ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏Ñ‡πà‡∏≤‡∏¢ **200-300 ‡∏Ñ‡∏≥**
   - ‡∏à‡∏∏‡∏î‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô/‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ö production ‡∏≠‡∏∑‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏¢
   - ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå
   - ‚ö†Ô∏è ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á Semantic Network ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ

10. **actorEvolution**: ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÅ‡∏™‡∏î‡∏á **200-300 ‡∏Ñ‡∏≥**
    - ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
    - ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô/‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

11. **genreRanking**: ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô 50-100 ‡∏Ñ‡∏≥

### üëÅÔ∏è Section 5: Viewing Experience (‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ä‡∏°)
12. **viewingTips**: ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ **200-300 ‡∏Ñ‡∏≥**
    - ‡∏Ñ‡∏ß‡∏£‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏à‡∏∏‡∏î‡πÑ‡∏´‡∏ô
    - ‡∏ä‡πà‡∏ß‡∏á‡πÑ‡∏´‡∏ô‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
    - ‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏û‡∏•‡∏≤‡∏î
    - ‚ö†Ô∏è ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö User-Centric (Google Helpful Content Update ‡∏ä‡∏≠‡∏ö!)

13. **bestMoments**: 3-5 ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡πÄ‡∏ä‡∏¥‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå)
14. **audienceMatch**: ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£/‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£ 100-150 ‡∏Ñ‡∏≥
15. **replayValue**: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏î‡∏π‡∏ã‡πâ‡∏≥ 50-100 ‡∏Ñ‡∏≥

---

## ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏´‡πâ‡∏≤‡∏° (DON'T)
- ‚ùå ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡πâ‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (REJECT ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!)
- ‚ùå ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡πÄ‡∏ã‡πá‡∏Å‡∏™‡πå", "‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏û‡∏®", "‡∏´‡∏•‡∏±‡πà‡∏á", "‡πÅ‡∏ï‡∏Å‡πÉ‡∏ô" - ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏≠‡πâ‡∏≠‡∏°‡∏Ñ‡πâ‡∏≠‡∏°
- ‚ùå Copy ‡∏à‡∏≤‡∏Å Summary ‡∏ï‡∏£‡∏á‡πÜ - ‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°
- ‚ùå ‡∏õ‡∏•‡πà‡∏≠‡∏¢ field ‡∏ß‡πà‡∏≤‡∏á
- ‚ùå ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö generic ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á - ‡∏ï‡πâ‡∏≠‡∏á specific
- ‚ùå **‡∏ú‡∏™‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÅ‡∏™‡∏î‡∏á** ‡πÄ‡∏ä‡πà‡∏ô "‡πÄ‡∏ã‡πá‡∏ô‡∏°‡∏∞ Mami", "Zemba ‡∏°‡∏≤‡∏°‡∏¥" ‚Üê ‡∏ú‡∏¥‡∏î! REJECT ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!
- ‚úÖ **‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ ENGLISH ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏°‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô** - copy ‡∏à‡∏≤‡∏Å Casts info ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏õ‡∏•‡∏á!

## ‚úÖ ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥ (DO)
- ‚úÖ ‡πÉ‡∏ä‡πâ‡∏®‡∏±‡∏û‡∏ó‡πå‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏î‡πâ‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå (Cinematography, Mise-en-sc√®ne)
- ‚úÖ ‡πÉ‡∏ä‡πâ‡∏®‡∏±‡∏û‡∏ó‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤/‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (Anxiety, Trust, Catharsis)
- ‚úÖ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö Educational ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≤
- ‚úÖ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö User-Centric ‡πÄ‡∏ô‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ú‡∏π‡πâ‡∏≠‡πà‡∏≤‡∏ô
- ‚úÖ ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏â‡∏≤‡∏Å‡∏à‡∏≤‡∏Å Highlights ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏°‡∏≤
`,
		chunk1.Summary,                        // Summary ‡∏à‡∏≤‡∏Å Chunk 1
		highlightsStr,                         // Highlights ‡∏à‡∏≤‡∏Å Chunk 1
		strings.Join(chunk1.SceneLocations, ", "), // Scene locations ‡∏à‡∏≤‡∏Å Chunk 1
		moodToneStr,                           // Mood/Tone ‡∏à‡∏≤‡∏Å Chunk 2
		chunk2.SettingDescription,             // Setting description ‡∏à‡∏≤‡∏Å Chunk 2
		chunk2.CharacterDynamic,               // Character dynamic ‡∏à‡∏≤‡∏Å Chunk 2
		chunk2.CharacterInsight,               // Character insight ‡∏à‡∏≤‡∏Å Chunk 2
		chunk2.PlotAnalysis,                   // Plot analysis ‡∏à‡∏≤‡∏Å Chunk 2
		chunk2.ComparisonNote,                 // Comparison note ‡∏à‡∏≤‡∏Å Chunk 2
		input.VideoMetadata.RealCode,
		durationStr,
		strings.Join(castNames, ", "),
		getMakerName(input.VideoMetadata.Maker),
		tagsStr.String(),
	)
}

// getMakerName safely extracts maker name from MakerMetadata pointer
func getMakerName(maker *models.MakerMetadata) string {
	if maker == nil {
		return "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡πà‡∏≤‡∏¢"
	}
	return maker.Name
}
